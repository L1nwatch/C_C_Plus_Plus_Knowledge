## 2. 命名规则

### 2.1 命名共性原则

* 标识符的长度应当符合 "min-length" && "max-information" 原则
* 程序中禁止出现仅靠大小写区分的相似标识符
* 程序中禁止出现标识符完全相同的局部变量和全局变量，尽管两者的作用域不同而不会发生语法错误，但会使人误解
* 变量的名字应当使用“名词”或者“形容词+名词”
* 全局函数的名字应当使用“动词”或者“动词+名词”。类的成员函数应当只使用“动词”，被忽略掉的名词就是对象本身。
* 避免名字中出现数字编号
* 类名和函数名用大写字母开头的单词组合而成
* 变量和参数用小写字母开头的单词组合而成
* 常量全用大写的字母，用下划线分割单词
* 静态变量前加前缀 s_（表示 static）
* 全局变量加前缀 g_（表示 global）
* 类的数据成员加前缀 m_（表示 member），这样可以避免数据成员与成员函数的参数同名
* 为了防止某一软件库中的一些标识符和其他软件库中的冲突，可以为各种标识符加上能反映软件性质的前缀。例如 DTCSP 接口的所有库函数均以 DTCSP_ 开头。

# 3. 文件结构

## 3.1 头文件结构

### 3.1.1 头文件定义规则

* 为了防止头文件被重复引用，应当用 ifndef/define/endif 结构产生预处理块
* 用 `#include <filename.h>` 格式来引用标准库的头文件（编译器将从标准库目录开始搜索）
* 用 `#include "filename.h"` 格式来引用非标准库的头文件（编译器将从用户的工作目录开始搜索）
* 头文件中只存放“声明”而不存放“定义”
* 不提倡使用全局变量，尽量不要在头文件中出现 `extern int value` 这类声明

### 3.1.2 头文件结构

头文件由三部分内容组成：

* 头文件开头处的版权和版本声明
* 预处理块
* 函数和类结构声明

### 3.1.3 头文件的作用

### 3.1.4 头文件例子

```c++
/*
 * Copyright (c) 2002, 济南得安计算机技术有限公司
 * All rights reserved.
 *
 * 文件名称: crypt.h
 *
 * 当前版本: 5.1
 * 作 者:
 * 完成日期: 2002年7月2日
 * 主要修改说明:
 *
 * 历史信息:
 * 版本: 1.0
 * 作者:
 * 日期: 2001年6月2日
 * 主要修改说明:
 *
 * 版本: 1.5
 * 作者:
 * 日期: 2001年8月2日
 * 主要修改说明:
 */
#ifndef _CRYPT_H_ // 防止 crypt.h 被重复引用
#define _CRYPT_H_


#ifdef _cplusplus
extern "C"
#endif


#define MAX_LEN 50


typedef struct {
    unsigned long ulHigh;
    unsigned long ulLength;
} MY_STRUCT;


void Function1(); // 全局函数声明

#endif //C_C_KNOWLEGE_HEAD_TEMPLATE_H
```

## 3.3 目录结构

如果一个软件的头文件数目比较多（如超过十个），通常应将头文件和实现文件分别保存于不同的目录，以便于维护。

加强信息隐藏，如果某些头文件是私有的，它不会被用户的程序直接引用，则没有必要公开其“声明”。例如：

* `\include` 存放公开的头文件
* `\myinc` 存放私有的头文件
* `\source` 存放 C 源代码

# 4、程序版式

## 4.1 使用空行

### 4.1.1 空行使用规则

* 在每个类声明之后、每个函数定义结束之后都要加空行。
* 在一个函数体内，逻辑上密切相关的语句之间不加空行，其他地方应加空行分隔。
* 关键字之后要留空格。比如 const、virtual、inline、case 等关键字，以及 if、for、while 等关键字之后应留一个空格。
* 函数名之后不要留空格
* ( 向后紧跟，）、,、;向前紧跟，紧跟处不留空格
* , 之后要留空格，如 Function(x, y, z)。如果 ';' 不是一行的结束符号，其后要留空格。
* 二元操作符的前后应当加空格
* 一元操作符等前后不加空格
* []、.、-> 这类操作符前后不加空格
* _对于表达式较长的 for 语句和 if 语句，为了紧凑起见可以去掉一些空格_


## 4.2 代码行

### 4.2.1 代码行书写规则

* 一行代码只做一件事情，如只定义一个变量，或只写一条语句。
* if、for、while、do 等语句自占一行，执行语句不得紧跟其后。不论执行语句有多少都要加 {}。这样可以防止书写失误。
* 程序的分界符“{”和“}”应独占一行并且位于同一列，同时与引用它们的语句左对齐。
* {}之内的代码块在{右边 4 格处左对齐，不适用 tab 键对齐
* 代码行最大长度控制在 70 ~ 80 个字符以内
* 长表达式要在低优先级操作符处拆分成新航，操作符放在新行之首
* 原则上一个函数内的代码行不能太长，一般应控制在 100 行以内。
* if 语句如遇到变量和常量相比较值，应当将常量放在前边。

## 4.5 注释

* 当代码比较长，特别是有多重嵌套时，应当在一些段落的结束处加注释，便于阅读

  * ```C++
    if (...)
    {
        ...
          
        while (...)
        {
            ...
        } // end of while
        
        ...
    } // end of if
    ```

* 对于所有有物理含义的变量、常量，如果其命名不是充分自注释的，在声明时都必须加以注释，说明其物理含义

* 全局变量要有较详细的注释，包括对其功能、取值范围、哪些函数或过程存取它以及存取时注意事项等的说明

  * ```c++
    /* The ErrorCode when SCCP translate */
    /* Global Title failure, as follows */ // 变量作用、含义
    /* 0 - SUCCESS 1 - GT Table error */
    /* 2 - GT error Others - no use */ // 变量取值范围
    /* only function SCCPTranslate() in */
    /* this modual can modify it, and other */
    /* module can visit it through call */
    /* the function GetGTTransErrorCode() */ // 使用方法
    BYTE g_GTTranErrorCode;
    ```

* 将注释与其上面的代码用空行隔开；可使程序排版整齐，并方便注释的阅读与理解

# 5、程序效率

* 规则【1】，每位学生都有多科学习成绩，故如上结构将占用较大空间。应分成两个结构，总的存贮空间将变小，操作也变得更方便。

* 规则【2】，循环体内工作量最小化

* 规则【3】，在多重循环中，应将最忙的循环放在最内层（减少 CPU 切入循环层的次数）

  * ```c++
    // 效率不高
    for (row = 0; row < 100; ++row)
    {
        for (col = 0; col < 5; ++col)
        {
            sum += a[row][col];
        }
    }
    ```

  * ```c++
    // 优化
    for (col = 0; col < 5; ++col)
    {
        for (row = 0; row < 5; ++row)
        {
            sum += a[row][col];
        }
    }
    ```

* 规则【4】，避免循环体内含判断语句，应将循环语句置于判断语句的代码块之中。说明：目的是减少判断次数。循环体中的判断语句是否可以移到循环体外，要视程序的具体情况而言，一般情况，与循环变量无关的判断语句可以移到循环体外，而有关的则不可以

# 6、质量保证

* 只引用属于自己的存贮空间
* 防止引用已经释放的内存空间
* 过程/函数中分配的内存，在过程/函数退出之前要释放
* 过程/函数中申请的（为打开文件而使用的）文件句柄，在过程/函数退出之前要关闭。
* 防止内存操作越界
* 系统运行之初，要初始化有关变量及运行环境，防止未经初始化的变量被引用
* 编程时，要防止差 1 错误（把 `<=` 误写成 `<` 之类的）
* 要时刻注意易混淆的操作符。当编完程序后，应从头至尾检查一遍这些操作符，以防止拼写错误。
* if 语句尽量加上 else 分支，对没有 else 分支的语句要小心对待；switch 语句必须有 default 分支
* Unix 下，多线程中的子线程退出必需采用主动退出方式，即子线程应 return 出口
* 不用 goto